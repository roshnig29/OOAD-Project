DROP DATABASE IF EXISTS moviedb;
CREATE DATABASE moviedb;
CREATE USER IF NOT EXISTS 'movieapp'@'%' IDENTIFIED BY 'moviepassword';
GRANT ALL ON moviedb.* TO 'movieapp'@'%';
USE moviedb;

CREATE TABLE IF NOT EXISTS THEATRE
(
    theatreId      int             NOT NULL AUTO_INCREMENT,
    theatreName    VARCHAR(30)     NOT NULL,
    primary key(theatreId)
);

CREATE TABLE IF NOT EXISTS MOVIE
(
    movieId        int             NOT NULL AUTO_INCREMENT,
    title          VARCHAR(30)     NOT NULL,
    rating         double          NOT NULL,
    theatreId      int             NOT NULL,
    releasedate    date            NOT NULL,
    price          double AS (rating * 3.5)    NOT NULL,
    PRIMARY KEY (movieId),
    foreign key(theatreId) references THEATRE(theatreId)
);

CREATE TABLE IF NOT EXISTS SHOWTIME
(
    showtimeId     int             NOT NULL AUTO_INCREMENT,
    movieId        int             NOT NULL,
    theatreId      int             NOT NULL,
    showtime       datetime        NOT NULL,
    primary key(showtimeId),
    foreign key(movieId) references MOVIE(movieId),
    foreign key(theatreId) references THEATRE(theatreId)
);

CREATE TABLE IF NOT EXISTS TICKET
(
    ticketId       int             NOT NULL AUTO_INCREMENT,
    showtimeId     int             NOT NULL,
    price          double          NOT NULL,
    primary key(ticketId),
    foreign key(showtimeId) references SHOWTIME(showtimeId)
);

CREATE TABLE IF NOT EXISTS COUPON
(
    couponId       int             NOT NULL AUTO_INCREMENT,
    couponCode     VARCHAR(255)    NOT NULL,
    couponAmount   double          NOT NULL,
    expiry         date            NOT NULL,
    primary key(couponId)
);

CREATE TABLE IF NOT EXISTS SEAT
(
    seatId         int             NOT NULL AUTO_INCREMENT,
    seatRow        int             NOT NULL,
    seatNum        int             NOT NULL,
    ticketId       int             NOT NULL,
    primary key (seatId),
    foreign key(ticketId) references TICKET(ticketId)
);

CREATE TABLE IF NOT EXISTS PAYMENT
(
    paymentId      int             NOT NULL AUTO_INCREMENT,
    holderName     VARCHAR(255)    NOT NULL,
    cardNumber     VARCHAR(255)    NOT NULL,
    expiry         date            NOT NULL,
    primary key(paymentId)
);

CREATE TABLE IF NOT EXISTS REGISTERED_USER
(
    userId         int             NOT NULL AUTO_INCREMENT,
    username       VARCHAR(255)    NOT NULL,
    password       VARCHAR(255)    NOT NULL,
    email          VARCHAR(255)    NOT NULL,
    address        VARCHAR(255)    NOT NULL,
    card           int             NOT NULL,
    lastPaid       date            NOT NULL,
    primary key(userId),
    foreign key (card) references PAYMENT(paymentId)
);

INSERT INTO THEATRE (theatreName) VALUES
("Orion Mall"),
("Mantri Mall"),
("Meenakshi Mall"),
("Kamakya Theatre"),
("PVR Cinemas");

INSERT INTO MOVIE (title, rating, theatreId, releasedate) VALUES
("Barbie", 4, 1, '2024-06-01'),
("The Lion King", 5, 1, '2024-06-02'),
("Kantara", 5, 2, '2024-05-01'),
("Hanuman", 4, 1, '2024-05-01'),
("Open Heimer", 3, 2, '2024-05-03');

INSERT INTO SHOWTIME (movieId, theatreId, showtime) VALUES
(1, 1, '2024-06-08 09:00:00'),
(1, 1, '2024-06-08 21:00:00'),
(1, 2, '2024-06-09 09:00:00'),
(1, 2, '2024-06-09 21:00:00'),
(1, 3, '2024-06-10 09:00:00'),
(1, 3, '2024-06-10 21:00:00'),
(1, 4, '2024-06-15 09:00:00'),
(1, 4, '2024-06-15 21:00:00'),
(1, 5, '2024-06-30 09:00:00'),
(1, 5, '2024-06-30 21:00:00'),
(2, 1, '2024-06-08 09:00:00'),
(2, 1, '2024-06-08 21:00:00'),
(2, 2, '2024-06-09 09:00:00'),
(2, 2, '2024-06-09 21:00:00'),
(2, 3, '2024-06-10 09:00:00'),
(2, 3, '2024-06-10 21:00:00'),
(2, 4, '2024-06-15 09:00:00'),
(2, 4, '2024-06-15 21:00:00'),
(2, 5, '2024-06-30 09:00:00'),
(2, 5, '2024-06-30 21:00:00'),
(3, 1, '2024-06-08 09:00:00'),
(3, 1, '2024-06-08 21:00:00'),
(3, 2, '2024-06-09 09:00:00'),
(3, 2, '2024-06-09 21:00:00'),
(3, 3, '2024-06-10 09:00:00'),
(3, 3, '2024-06-10 21:00:00'),
(3, 4, '2024-06-15 09:00:00'),
(3, 4, '2024-06-15 21:00:00'),
(3, 5, '2024-06-30 09:00:00'),
(3, 5, '2024-06-30 21:00:00'),
(4, 1, '2024-06-08 09:00:00'),
(4, 1, '2024-06-08 21:00:00'),
(4, 2, '2024-06-09 09:00:00'),
(4, 2, '2024-06-09 21:00:00'),
(4, 3, '2024-06-10 09:00:00'),
(4, 3, '2024-06-10 21:00:00'),
(4, 4, '2024-06-15 09:00:00'),
(4, 4, '2024-06-15 21:00:00'),
(4, 5, '2024-06-30 09:00:00'),
(4, 5, '2024-06-30 21:00:00'),
(5, 1, '2024-06-08 09:00:00'),
(5, 1, '2024-06-08 21:00:00'),
(5, 2, '2024-06-09 09:00:00'),
(5, 2, '2024-06-09 21:00:00'),
(5, 3, '2024-06-10 09:00:00'),
(5, 3, '2024-06-10 21:00:00'),
(5, 4, '2024-06-15 09:00:00'),
(5, 4, '2024-06-15 21:00:00'),
(5, 5, '2024-06-30 09:00:00'),
(5, 5, '2024-06-30 21:00:00');

INSERT INTO TICKET (showtimeId, price) VALUES
(1, 14),
(1, 14),
(2, 14),
(2, 14),
(3, 14),
(3, 14),
(4, 14),
(4, 14),
(5, 14),
(5, 14),
(6, 14),
(6, 14),
(7, 14),
(7, 14),
(8, 14),
(8, 14),
(9, 14),
(9, 14),
(10, 14),
(10, 14),
(11, 17.5),
(11, 17.5),
(12, 17.5),
(12, 17.5),
(13, 17.5),
(13, 17.5),
(14, 17.5),
(14, 17.5),
(15, 17.5),
(15, 17.5),
(16, 17.5),
(16, 17.5),
(17, 17.5),
(17, 17.5),
(18, 17.5),
(18, 17.5),
(19, 17.5),
(19, 17.5),
(20, 17.5),
(20, 17.5),
(21, 10.5),
(21, 10.5),
(22, 10.5),
(22, 10.5),
(23, 10.5),
(23, 10.5),
(24, 10.5),
(24, 10.5),
(25, 10.5),
(25, 10.5),
(26, 10.5),
(26, 10.5),
(27, 10.5),
(27, 10.5),
(28, 10.5),
(28, 10.5),
(29, 10.5),
(29, 10.5),
(30, 10.5),
(30, 10.5),
(31, 14),
(31, 14),
(32, 14),
(32, 14),
(33, 14),
(33, 14),
(34, 14),
(34, 14),
(35, 14),
(35, 14),
(36, 14),
(36, 14),
(37, 14),
(37, 14),
(38, 14),
(38, 14),
(39, 14),
(39, 14),
(40, 14),
(40, 14),
(41, 10.5),
(41, 10.5),
(42, 10.5),
(42, 10.5),
(43, 10.5),
(43, 10.5),
(44, 10.5),
(44, 10.5),
(45, 10.5),
(45, 10.5),
(46, 10.5),
(46, 10.5),
(47, 10.5),
(47, 10.5),
(48, 10.5),
(48, 10.5),
(49, 10.5),
(49, 10.5),
(50, 10.5),
(50, 10.5);

INSERT INTO SEAT (seatRow, seatNum, ticketId) VALUES
(1, 1, 1),
(1, 2, 2),
(1, 1, 3),
(1, 2, 4),
(1, 1, 5),
(1, 2, 6),
(1, 1, 7),
(1, 2, 8),
(1, 1, 9),
(1, 2, 10),
(1, 1, 11),
(1, 2, 12),
(1, 1, 13),
(1, 2, 14),
(1, 1, 15),
(1, 2, 16),
(1, 1, 17),
(1, 2, 18),
(1, 1, 19),
(1, 2, 20),
(1, 1, 21),
(1, 2, 22),
(1, 1, 23),
(1, 2, 24),
(1, 1, 25),
(1, 2, 26),
(1, 1, 27),
(1, 2, 28),
(1, 1, 29),
(1, 2, 30),
(1, 1, 31),
(1, 2, 32),
(1, 1, 33),
(1, 2, 34),
(1, 1, 35),
(1, 2, 36),
(1, 1, 37),
(1, 2, 38),
(1, 1, 39),
(1, 2, 40),
(1, 1, 41),
(1, 2, 42),
(1, 1, 43),
(1, 2, 44),
(1, 1, 45),
(1, 2, 46),
(1, 1, 47),
(1, 2, 48),
(1, 1, 49),
(1, 2, 50),
(1, 1, 51),
(1, 2, 52),
(1, 1, 53),
(1, 2, 54),
(1, 1, 55),
(1, 2, 56),
(1, 1, 57),
(1, 2, 58),
(1, 1, 59),
(1, 2, 60),
(1, 1, 61),
(1, 2, 62),
(1, 1, 63),
(1, 2, 64),
(1, 1, 65),
(1, 2, 66),
(1, 1, 67),
(1, 2, 68),
(1, 1, 69),
(1, 2, 70),
(1, 1, 71),
(1, 2, 72),
(1, 1, 73),
(1, 2, 74),
(1, 1, 75),
(1, 2, 76),
(1, 1, 77),
(1, 2, 78),
(1, 1, 79),
(1, 2, 80),
(1, 1, 81),
(1, 2, 82),
(1, 1, 83),
(1, 2, 84),
(1, 1, 85),
(1, 2, 86),
(1, 1, 87),
(1, 2, 88),
(1, 1, 89),
(1, 2, 90),
(1, 1, 91),
(1, 2, 92),
(1, 1, 93),
(1, 2, 94),
(1, 1, 95),
(1, 2, 96),
(1, 1, 97),
(1, 2, 98),
(1, 1, 99),
(1, 2, 100);

INSERT INTO PAYMENT (holderName, cardNumber, expiry) VALUES
("Lizeth Cowan", "5355142077868730", "2023-01-01"),
("Jovanny Orozco", "5598855665566810", "2022-01-01"),
("Donavan Hunter", "5565149389994340", "2022-02-01"),
("Bryce Blair", "5468258212174080", "2023-04-01"),
("Kelsey Curry", "5119080811765270", "2028-01-01"),
("Dayami Simon", "5162680765761620", "2022-11-01"),
("Caitlyn Bean", "5179341601731640", "2024-12-01"),
("Salvador Cain", "5580095333314690", "2025-11-01"),
("Jared Nash", "5113181095909820", "2026-12-01"),
("Indhu", "5534346641931920", "2023-06-01");

INSERT INTO REGISTERED_USER (username, password, email, address, card, lastPaid) VALUES
("romeo.sosa", "password3", "romeo.sosa@ucalgary.ca", "721 Gates St. Lachute, QC J8H 8J8", 10, "2021-04-21"),
("jared.nash", "password6", "jared.nash@ucalgary.ca", "8489 Tallwood St. Laval-sur-le-Lac, QC H7R 9L1", 9, "2021-03-17"),
("salvador.cain", "password9", "salvador.cain@ucalgary.ca", "469 Pennington St. Sainte-Julie, QC J3E 1J1", 8, "2021-04-30"),
("caitlyn.bean", "password12", "caitlyn.bean@ucalgary.ca", "992 Lawrence St. L'Assomption, QC J5W 2M5", 7, "2021-05-15"),
("dayami.simon", "password15", "dayami.simon@ucalgary.ca", "33 Hawthorne St. Moncton, NB E1A 3B9", 6, "2021-06-01"),
("kelsey.curry", "password18", "kelsey.curry@ucalgary.ca", "533 S. South Street Windsor, ON N9E 1H3", 5, "2021-06-15"),
("bryce.blair", "password21", "bryce.blair@ucalgary.ca", "7661 Temple Street Ajax, ON L1T 3Y6", 4, "2021-07-01"),
("donavan.hunter", "password24", "donavan.hunter@ucalgary.ca", "8762 Arnold Dr. Yellowknife, NT X1A 2H3", 3, "2021-07-15"),
("jovanny.orozco", "password27", "jovanny.orozco@ucalgary.ca", "9938 Bayport Lane Vernon, BC V1B 1M7", 2, "2021-08-01"),
("indhu.blair", "password30", "indhuramachandra7@gmail.com", "109 Loknath Nilaya Krishna Layout Hulimavu", 1, "2021-08-15");

INSERT INTO COUPON (couponCode, couponAmount, expiry) VALUES
('MOVIE50', 10, '2024-06-30'),
('HOLIDAY20', 20, '2024-07-15');